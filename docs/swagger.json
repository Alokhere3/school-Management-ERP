{
  "openapi": "3.0.0",
  "info": {
    "title": "School ERP API",
    "version": "2.0.0",
    "description": "School Management System API with RBAC and secure cookie-based authentication",
    "contact": {
      "name": "API Support"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    },
    {
      "url": "https://api.yourschool.com",
      "description": "Production server"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT token in Authorization header (backward compatibility)"
      },
      "cookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "accessToken",
        "description": "JWT access token stored in HTTP-only cookie (recommended)"
      }
    },
    "schemas": {
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "error": {
            "type": "string",
            "example": "Error message"
          },
          "code": {
            "type": "string",
            "example": "ERROR_CODE"
          },
          "details": {
            "type": "array",
            "items": {
              "type": "object"
            }
          }
        }
      },
      "Staff": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "tenantId": {
            "type": "string",
            "format": "uuid"
          },
          "firstName": {
            "type": "string"
          },
          "lastName": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "role": {
            "type": "string"
          },
          "department": {
            "type": "string"
          },
          "designation": {
            "type": "string"
          },
          "gender": {
            "type": "string",
            "enum": [
              "Male",
              "Female",
              "Other"
            ]
          },
          "primaryContactNumber": {
            "type": "string"
          },
          "dateOfBirth": {
            "type": "string",
            "format": "date"
          },
          "dateOfJoining": {
            "type": "string",
            "format": "date"
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "inactive",
              "terminated"
            ]
          },
          "photoUrl": {
            "type": "string",
            "format": "uri"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Role": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "tenantId": {
            "type": "string",
            "format": "uuid",
            "nullable": true
          },
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string",
            "nullable": true
          },
          "isSystemRole": {
            "type": "boolean"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "name",
          "isSystemRole"
        ]
      },
      "Tenant": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "inactive"
            ]
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "name"
        ]
      },
      "UserRole": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "isSystemRole": {
            "type": "boolean"
          },
          "roleId": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "inactive",
              "suspended"
            ]
          },
          "roles": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UserRole"
            }
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      }
    }
  },
  "security": [
    {
      "bearerAuth": []
    },
    {
      "cookieAuth": []
    }
  ],
  "tags": [
    {
      "name": "Auth",
      "description": "Authentication and authorization endpoints"
    },
    {
      "name": "Students",
      "description": "Student management endpoints"
    },
    {
      "name": "Staff",
      "description": "Staff (HR) management endpoints"
    },
    {
      "name": "Tenants",
      "description": "Tenant management endpoints"
    },
    {
      "name": "Roles",
      "description": "Role and permission management"
    },
    {
      "name": "Images",
      "description": "Image proxy endpoints"
    }
  ],
  "paths": {
    "/api/attendance": {
      "get": {
        "tags": [
          "Attendance"
        ],
        "summary": "List attendance records",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "post": {
        "tags": [
          "Attendance"
        ],
        "summary": "Create attendance record",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "studentId": {
                    "type": "string"
                  },
                  "date": {
                    "type": "string",
                    "format": "date"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "present",
                      "absent",
                      "late"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/attendance/{id}": {
      "get": {
        "tags": [
          "Attendance"
        ],
        "summary": "Get attendance record by id",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "put": {
        "tags": [
          "Attendance"
        ],
        "summary": "Update attendance record",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "present",
                      "absent",
                      "late"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "delete": {
        "tags": [
          "Attendance"
        ],
        "summary": "Delete attendance record",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Deleted"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      }
    },
    "/api/auth/register": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Register tenant and admin",
        "description": "Register a new tenant and create the initial admin user.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "tenantName",
                  "tenantType",
                  "adminName",
                  "adminEmail",
                  "password"
                ],
                "properties": {
                  "tenantName": {
                    "type": "string"
                  },
                  "tenantType": {
                    "type": "string",
                    "enum": [
                      "School",
                      "Institute",
                      "University"
                    ]
                  },
                  "address": {
                    "type": "string"
                  },
                  "contactNumber": {
                    "type": "string"
                  },
                  "adminName": {
                    "type": "string"
                  },
                  "adminEmail": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string",
                    "format": "password"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Login user",
        "description": "Authenticate user and receive tokens.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email",
                  "password"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string",
                    "format": "password"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/reset-password": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Reset password",
        "description": "Reset password using a temporary token.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "token",
                  "newPassword"
                ],
                "properties": {
                  "token": {
                    "type": "string"
                  },
                  "newPassword": {
                    "type": "string",
                    "format": "password"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/classes": {
      "get": {
        "tags": [
          "Classes"
        ],
        "summary": "List classes for the tenant",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "post": {
        "tags": [
          "Classes"
        ],
        "summary": "Create a class (Admin only)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "className"
                ],
                "properties": {
                  "className": {
                    "type": "string"
                  },
                  "section": {
                    "type": "string"
                  },
                  "noOfStudents": {
                    "type": "integer"
                  },
                  "noOfSubjects": {
                    "type": "integer"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "active",
                      "inactive"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          }
        }
      }
    },
    "/api/classes/{id}": {
      "get": {
        "tags": [
          "Classes"
        ],
        "summary": "Get class by id",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "404": {
            "description": "Not found"
          }
        }
      },
      "put": {
        "tags": [
          "Classes"
        ],
        "summary": "Update class (Admin only)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "className": {
                    "type": "string"
                  },
                  "section": {
                    "type": "string"
                  },
                  "noOfStudents": {
                    "type": "integer"
                  },
                  "noOfSubjects": {
                    "type": "integer"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "active",
                      "inactive"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "404": {
            "description": "Not found"
          }
        }
      },
      "delete": {
        "tags": [
          "Classes"
        ],
        "summary": "Delete class (Admin only)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Deleted"
          },
          "404": {
            "description": "Not found"
          }
        }
      }
    },
    "/api/communication": {
      "get": {
        "tags": [
          "Communication"
        ],
        "summary": "List messages",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "post": {
        "tags": [
          "Communication"
        ],
        "summary": "Send message/announcement",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "subject": {
                    "type": "string"
                  },
                  "message": {
                    "type": "string"
                  },
                  "recipientIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/communication/{id}": {
      "get": {
        "tags": [
          "Communication"
        ],
        "summary": "Get message by id",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "put": {
        "tags": [
          "Communication"
        ],
        "summary": "Update message",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "subject": {
                    "type": "string"
                  },
                  "message": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      }
    },
    "/api/exams": {
      "get": {
        "tags": [
          "Exams"
        ],
        "summary": "List exams",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "post": {
        "tags": [
          "Exams"
        ],
        "summary": "Create exam",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "subject": {
                    "type": "string"
                  },
                  "date": {
                    "type": "string",
                    "format": "date"
                  },
                  "duration": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/exams/{id}": {
      "get": {
        "tags": [
          "Exams"
        ],
        "summary": "Get exam by id",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "put": {
        "tags": [
          "Exams"
        ],
        "summary": "Update exam",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "subject": {
                    "type": "string"
                  },
                  "date": {
                    "type": "string",
                    "format": "date"
                  },
                  "duration": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "delete": {
        "tags": [
          "Exams"
        ],
        "summary": "Delete exam",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Deleted"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      }
    },
    "/api/fees": {
      "get": {
        "tags": [
          "Fees"
        ],
        "summary": "List fees",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "post": {
        "tags": [
          "Fees"
        ],
        "summary": "Create fee record",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "studentId": {
                    "type": "string"
                  },
                  "amount": {
                    "type": "number"
                  },
                  "description": {
                    "type": "string"
                  },
                  "dueDate": {
                    "type": "string",
                    "format": "date"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/fees/{id}": {
      "get": {
        "tags": [
          "Fees"
        ],
        "summary": "Get fee record by id",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "put": {
        "tags": [
          "Fees"
        ],
        "summary": "Update fee record",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "amount": {
                    "type": "number"
                  },
                  "description": {
                    "type": "string"
                  },
                  "dueDate": {
                    "type": "string",
                    "format": "date"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "delete": {
        "tags": [
          "Fees"
        ],
        "summary": "Delete fee record",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Deleted"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      }
    },
    "/images/{key}": {
      "get": {
        "tags": [
          "Images"
        ],
        "summary": "Proxy endpoint to stream images from S3",
        "description": "Proxy endpoint to stream images from S3 without exposing S3 URLs",
        "parameters": [
          {
            "in": "path",
            "name": "key",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The S3 object key (stored in DB as photoKey). Can contain slashes (e.g., tenants/123/students/photo.jpg)"
          }
        ],
        "responses": {
          "200": {
            "description": "Image stream from S3"
          },
          "400": {
            "description": "Invalid image key"
          },
          "404": {
            "description": "Image not found"
          },
          "500": {
            "description": "Failed to retrieve image"
          }
        }
      }
    },
    "/api/v1/tenants/{tenantId}/staff": {
      "post": {
        "tags": [
          "Onboarding"
        ],
        "summary": "Create staff member with optional portal access",
        "description": "Creates a staff member and optionally creates a User account with temporary password for portal access.",
        "security": [
          {
            "bearerAuth": []
          },
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "tenantId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "firstName",
                  "lastName"
                ],
                "properties": {
                  "firstName": {
                    "type": "string"
                  },
                  "lastName": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "designation": {
                    "type": "string"
                  },
                  "department": {
                    "type": "string"
                  },
                  "employeeType": {
                    "type": "string"
                  },
                  "enablePortalAccess": {
                    "type": "boolean",
                    "description": "If true, creates User account with temporary password"
                  },
                  "role": {
                    "type": "string",
                    "enum": [
                      "TEACHER",
                      "STAFF",
                      "ACCOUNTANT",
                      "LIBRARIAN",
                      "ADMIN"
                    ],
                    "description": "Role to assign if portal access is enabled"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Staff created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "staff": {
                          "$ref": "#/components/schemas/Staff"
                        },
                        "credentials": {
                          "type": "object",
                          "nullable": true,
                          "properties": {
                            "email": {
                              "type": "string"
                            },
                            "tempPassword": {
                              "type": "string"
                            },
                            "mustChangePassword": {
                              "type": "boolean"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "409": {
            "description": "Email already exists"
          }
        }
      }
    },
    "/api/v1/tenants/{tenantId}/admissions/create-with-users": {
      "post": {
        "tags": [
          "Onboarding"
        ],
        "summary": "Create student with parents and optional user accounts",
        "description": "Creates a student record, parent records, and optionally creates User accounts for student and parents with temporary passwords.",
        "security": [
          {
            "bearerAuth": []
          },
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "tenantId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "student"
                ],
                "properties": {
                  "student": {
                    "type": "object",
                    "description": "Student data (all Student model fields)"
                  },
                  "createStudentUser": {
                    "type": "boolean",
                    "description": "If true, creates User account for student"
                  },
                  "parents": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string"
                        },
                        "phone": {
                          "type": "string"
                        },
                        "relation": {
                          "type": "string",
                          "enum": [
                            "Father",
                            "Mother",
                            "Guardian",
                            "Grandparent",
                            "Other"
                          ]
                        },
                        "createUser": {
                          "type": "boolean"
                        },
                        "isPrimary": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Student and parents created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "student": {
                          "$ref": "#/components/schemas/Student"
                        },
                        "credentials": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "STUDENT",
                                  "PARENT"
                                ]
                              },
                              "email": {
                                "type": "string"
                              },
                              "tempPassword": {
                                "type": "string"
                              },
                              "method": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/roles": {
      "get": {
        "tags": [
          "Roles"
        ],
        "summary": "List all roles",
        "description": "Returns both system roles and tenant-specific roles. If tenantId is provided, returns system roles plus roles for that tenant.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            },
            "description": "Page number"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 10
            },
            "description": "Number of items per page"
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            },
            "description": "Search by name or description"
          },
          {
            "in": "query",
            "name": "sortBy",
            "schema": {
              "type": "string",
              "default": "name"
            },
            "description": "Field to sort by"
          },
          {
            "in": "query",
            "name": "sortOrder",
            "schema": {
              "type": "string",
              "enum": [
                "ASC",
                "DESC"
              ],
              "default": "ASC"
            },
            "description": "Sort order"
          },
          {
            "in": "query",
            "name": "tenantId",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Optional tenant ID to filter roles"
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Role"
                      }
                    },
                    "count": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "post": {
        "tags": [
          "Roles"
        ],
        "summary": "Create a new role",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "tenantId": {
                    "type": "string",
                    "format": "uuid"
                  },
                  "isSystemRole": {
                    "type": "boolean"
                  }
                },
                "required": [
                  "name"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Role"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "409": {
            "description": "Conflict - role name already exists"
          }
        }
      }
    },
    "/api/roles/{id}": {
      "get": {
        "tags": [
          "Roles"
        ],
        "summary": "Get role by ID",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Role"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "put": {
        "tags": [
          "Roles"
        ],
        "summary": "Update role",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Role"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          },
          "409": {
            "description": "Conflict - role name already exists"
          }
        }
      },
      "delete": {
        "tags": [
          "Roles"
        ],
        "summary": "Delete role",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Deleted"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      }
    },
    "/api/roles/{id}/permissions": {
      "get": {
        "tags": [
          "Roles"
        ],
        "summary": "Get role permissions",
        "description": "Get all permissions for a specific role, grouped by module",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Role not found"
          }
        }
      },
      "put": {
        "tags": [
          "Roles"
        ],
        "summary": "Update role permissions (bulk)",
        "description": "Update multiple permissions for a role at once",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "permissions": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "module": {
                          "type": "string"
                        },
                        "actions": {
                          "type": "object",
                          "additionalProperties": {
                            "type": "string",
                            "enum": [
                              "none",
                              "read",
                              "limited",
                              "full"
                            ]
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Role not found"
          }
        }
      }
    },
    "/api/roles/{id}/permissions/{module}": {
      "put": {
        "tags": [
          "Roles"
        ],
        "summary": "Update all permissions for a module",
        "description": "Update all permissions (create, read, update, delete, export) for a specific module",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "in": "path",
            "name": "module",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "actions": {
                    "type": "object",
                    "properties": {
                      "create": {
                        "type": "string",
                        "enum": [
                          "none",
                          "read",
                          "limited",
                          "full"
                        ]
                      },
                      "read": {
                        "type": "string",
                        "enum": [
                          "none",
                          "read",
                          "limited",
                          "full"
                        ]
                      },
                      "update": {
                        "type": "string",
                        "enum": [
                          "none",
                          "read",
                          "limited",
                          "full"
                        ]
                      },
                      "delete": {
                        "type": "string",
                        "enum": [
                          "none",
                          "read",
                          "limited",
                          "full"
                        ]
                      },
                      "export": {
                        "type": "string",
                        "enum": [
                          "none",
                          "read",
                          "limited",
                          "full"
                        ]
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Role or module not found"
          }
        }
      }
    },
    "/api/roles/{id}/permissions/{module}/allow-all": {
      "put": {
        "tags": [
          "Roles"
        ],
        "summary": "Set AllowAll for a module",
        "description": "Grant full access to all actions for a specific module (equivalent to checking \"AllowAll\" checkbox)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "in": "path",
            "name": "module",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "allowAll": {
                    "type": "boolean",
                    "description": "true to grant full access, false to remove all permissions"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Role or module not found"
          }
        }
      }
    },
    "/api/roles/{id}/permissions/{module}/{action}": {
      "put": {
        "tags": [
          "Roles"
        ],
        "summary": "Update a single permission",
        "description": "Update a specific permission (module + action) for a role",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "in": "path",
            "name": "module",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "action",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "create",
                "read",
                "update",
                "delete",
                "export"
              ]
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "level": {
                    "type": "string",
                    "enum": [
                      "none",
                      "read",
                      "limited",
                      "full"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Role, module, or action not found"
          }
        }
      }
    },
    "/api/staff": {
      "get": {
        "tags": [
          "Staff"
        ],
        "summary": "List staff members",
        "description": "List all staff members with pagination and filtering. Requires hr_payroll:read permission.",
        "security": [
          {
            "bearerAuth": []
          },
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "department",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "role",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "designation",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "post": {
        "tags": [
          "Staff"
        ],
        "summary": "Create staff member",
        "description": "Create a new staff member with optional file uploads (photo, resume, joining letter). Requires hr_payroll:create permission.",
        "security": [
          {
            "bearerAuth": []
          },
          {
            "cookieAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "firstName": {
                    "type": "string"
                  },
                  "lastName": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string"
                  },
                  "role": {
                    "type": "string"
                  },
                  "department": {
                    "type": "string"
                  },
                  "designation": {
                    "type": "string"
                  },
                  "photo": {
                    "type": "string",
                    "format": "binary"
                  },
                  "resume": {
                    "type": "string",
                    "format": "binary"
                  },
                  "joiningLetter": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/staff/{id}": {
      "get": {
        "tags": [
          "Staff"
        ],
        "summary": "Get staff by id",
        "description": "Get detailed information about a specific staff member. Requires hr_payroll:read permission.",
        "security": [
          {
            "bearerAuth": []
          },
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "put": {
        "tags": [
          "Staff"
        ],
        "summary": "Update staff",
        "description": "Update an existing staff member. All fields are optional. Requires hr_payroll:update permission.",
        "security": [
          {
            "bearerAuth": []
          },
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "firstName": {
                    "type": "string"
                  },
                  "lastName": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "delete": {
        "tags": [
          "Staff"
        ],
        "summary": "Delete staff (soft delete)",
        "description": "Soft delete a staff member (sets status to inactive). Requires hr_payroll:delete permission.",
        "security": [
          {
            "bearerAuth": []
          },
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Deleted"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      }
    },
    "/api/students": {
      "get": {
        "tags": [
          "Students"
        ],
        "summary": "List students",
        "description": "Retrieve all students with optional filtering by classId. Use classId query parameter to filter students by class.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            },
            "description": "Page number for pagination (default 1)"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            },
            "description": "Records per page (default 20)"
          },
          {
            "in": "query",
            "name": "classId",
            "schema": {
              "type": "string"
            },
            "description": "Optional - Filter students by class ID"
          }
        ],
        "responses": {
          "200": {
            "description": "OK - List of students"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "post": {
        "tags": [
          "Students"
        ],
        "summary": "Create student with all fields",
        "description": "Create a new student with all personal, academic, contact, and family information in a single request. Admission number is auto-generated per school.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "firstName",
                  "dateOfBirth"
                ],
                "properties": {
                  "admissionNo": {
                    "type": "string",
                    "description": "Auto-generated if not provided"
                  },
                  "firstName": {
                    "type": "string"
                  },
                  "lastName": {
                    "type": "string"
                  },
                  "dateOfBirth": {
                    "type": "string",
                    "format": "date"
                  },
                  "photo": {
                    "type": "string",
                    "format": "binary"
                  },
                  "session": {
                    "type": "string"
                  },
                  "admissionClass": {
                    "type": "string"
                  },
                  "stream": {
                    "type": "string"
                  },
                  "admissionType": {
                    "type": "string",
                    "enum": [
                      "New",
                      "Transfer"
                    ]
                  },
                  "previousSchoolName": {
                    "type": "string"
                  },
                  "previousSchoolBoard": {
                    "type": "string"
                  },
                  "previousClassAttended": {
                    "type": "string"
                  },
                  "previousResult": {
                    "type": "string"
                  },
                  "studentName": {
                    "type": "string"
                  },
                  "gender": {
                    "type": "string",
                    "enum": [
                      "Male",
                      "Female",
                      "Other"
                    ]
                  },
                  "placeOfBirth": {
                    "type": "string"
                  },
                  "motherTongue": {
                    "type": "string"
                  },
                  "nationality": {
                    "type": "string"
                  },
                  "category": {
                    "type": "string",
                    "enum": [
                      "General",
                      "OBC",
                      "SC",
                      "ST",
                      "Other"
                    ]
                  },
                  "religion": {
                    "type": "string"
                  },
                  "aadharNumber": {
                    "type": "string"
                  },
                  "currentAddressLine1": {
                    "type": "string"
                  },
                  "currentAddressLine2": {
                    "type": "string"
                  },
                  "currentCity": {
                    "type": "string"
                  },
                  "currentDistrict": {
                    "type": "string"
                  },
                  "currentState": {
                    "type": "string"
                  },
                  "currentPIN": {
                    "type": "string"
                  },
                  "permanentAddressLine1": {
                    "type": "string"
                  },
                  "permanentAddressLine2": {
                    "type": "string"
                  },
                  "permanentCity": {
                    "type": "string"
                  },
                  "permanentDistrict": {
                    "type": "string"
                  },
                  "permanentState": {
                    "type": "string"
                  },
                  "permanentPIN": {
                    "type": "string"
                  },
                  "studentMobile": {
                    "type": "string"
                  },
                  "studentEmail": {
                    "type": "string"
                  },
                  "fatherName": {
                    "type": "string"
                  },
                  "fatherPhone": {
                    "type": "string"
                  },
                  "fatherOccupation": {
                    "type": "string"
                  },
                  "fatherEmail": {
                    "type": "string"
                  },
                  "motherName": {
                    "type": "string"
                  },
                  "motherPhone": {
                    "type": "string"
                  },
                  "motherOccupation": {
                    "type": "string"
                  },
                  "motherEmail": {
                    "type": "string"
                  },
                  "guardianName": {
                    "type": "string"
                  },
                  "guardianPhone": {
                    "type": "string"
                  },
                  "guardianRelation": {
                    "type": "string"
                  },
                  "emergencyContact": {
                    "type": "string"
                  },
                  "emergencyContactPhone": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Student created successfully"
          },
          "400": {
            "description": "Validation error"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/students/class/{classId}": {
      "get": {
        "tags": [
          "Students"
        ],
        "summary": "Get all students in a class",
        "description": "Retrieve all students belonging to a specific class ID",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "classId",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Class ID to filter students"
          },
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            },
            "description": "Page number for pagination (default 1)"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            },
            "description": "Records per page (default 20)"
          }
        ],
        "responses": {
          "200": {
            "description": "OK - List of students in the class"
          },
          "400": {
            "description": "Bad Request - classId is required"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/api/students/{id}": {
      "get": {
        "tags": [
          "Students"
        ],
        "summary": "Get student by id with all fields",
        "description": "Returns complete student information including personal, academic, contact, address, and family details",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Student retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "admissionNo": {
                          "type": "string"
                        },
                        "firstName": {
                          "type": "string"
                        },
                        "lastName": {
                          "type": "string"
                        },
                        "dateOfBirth": {
                          "type": "string",
                          "format": "date"
                        },
                        "photoUrl": {
                          "type": "string"
                        },
                        "contacts": {
                          "type": "array",
                          "description": "Array of contact information (Father, Mother, Guardian, Emergency, Student)"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Student not found"
          }
        }
      },
      "put": {
        "tags": [
          "Students"
        ],
        "summary": "Update student with all fields",
        "description": "Update student information. All fields are optional - only provided fields will be updated.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "admissionNo": {
                    "type": "string"
                  },
                  "firstName": {
                    "type": "string"
                  },
                  "lastName": {
                    "type": "string"
                  },
                  "dateOfBirth": {
                    "type": "string",
                    "format": "date"
                  },
                  "photo": {
                    "type": "string",
                    "format": "binary"
                  },
                  "session": {
                    "type": "string"
                  },
                  "admissionClass": {
                    "type": "string"
                  },
                  "stream": {
                    "type": "string"
                  },
                  "admissionType": {
                    "type": "string",
                    "enum": [
                      "New",
                      "Transfer"
                    ]
                  },
                  "previousSchoolName": {
                    "type": "string"
                  },
                  "previousSchoolBoard": {
                    "type": "string"
                  },
                  "previousClassAttended": {
                    "type": "string"
                  },
                  "previousResult": {
                    "type": "string"
                  },
                  "studentName": {
                    "type": "string"
                  },
                  "gender": {
                    "type": "string",
                    "enum": [
                      "Male",
                      "Female",
                      "Other"
                    ]
                  },
                  "placeOfBirth": {
                    "type": "string"
                  },
                  "motherTongue": {
                    "type": "string"
                  },
                  "nationality": {
                    "type": "string"
                  },
                  "category": {
                    "type": "string",
                    "enum": [
                      "General",
                      "OBC",
                      "SC",
                      "ST",
                      "Other"
                    ]
                  },
                  "religion": {
                    "type": "string"
                  },
                  "aadharNumber": {
                    "type": "string"
                  },
                  "currentAddressLine1": {
                    "type": "string"
                  },
                  "currentAddressLine2": {
                    "type": "string"
                  },
                  "currentCity": {
                    "type": "string"
                  },
                  "currentDistrict": {
                    "type": "string"
                  },
                  "currentState": {
                    "type": "string"
                  },
                  "currentPIN": {
                    "type": "string"
                  },
                  "permanentAddressLine1": {
                    "type": "string"
                  },
                  "permanentAddressLine2": {
                    "type": "string"
                  },
                  "permanentCity": {
                    "type": "string"
                  },
                  "permanentDistrict": {
                    "type": "string"
                  },
                  "permanentState": {
                    "type": "string"
                  },
                  "permanentPIN": {
                    "type": "string"
                  },
                  "studentMobile": {
                    "type": "string"
                  },
                  "studentEmail": {
                    "type": "string"
                  },
                  "fatherName": {
                    "type": "string"
                  },
                  "fatherPhone": {
                    "type": "string"
                  },
                  "fatherOccupation": {
                    "type": "string"
                  },
                  "fatherEmail": {
                    "type": "string"
                  },
                  "motherName": {
                    "type": "string"
                  },
                  "motherPhone": {
                    "type": "string"
                  },
                  "motherOccupation": {
                    "type": "string"
                  },
                  "motherEmail": {
                    "type": "string"
                  },
                  "guardianName": {
                    "type": "string"
                  },
                  "guardianPhone": {
                    "type": "string"
                  },
                  "guardianRelation": {
                    "type": "string"
                  },
                  "emergencyContact": {
                    "type": "string"
                  },
                  "emergencyContactPhone": {
                    "type": "string"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "active",
                      "inactive"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully"
          },
          "400": {
            "description": "Validation error"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "delete": {
        "tags": [
          "Students"
        ],
        "summary": "Delete student",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Deleted"
          },
          "404": {
            "description": "Not Found"
          }
        }
      }
    },
    "/api/teachers": {
      "post": {
        "tags": [
          "Teachers"
        ],
        "summary": "Create a new teacher",
        "description": "Create a new teacher with profile image, resume, and joining letter uploads. teacherId is optional and will be auto-generated per tenant starting from 1 if not provided.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "firstName",
                  "lastName",
                  "email",
                  "password"
                ],
                "properties": {
                  "firstName": {
                    "type": "string",
                    "example": "John"
                  },
                  "lastName": {
                    "type": "string",
                    "example": "Doe"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "example": "john.doe@school.com"
                  },
                  "password": {
                    "type": "string",
                    "format": "password",
                    "example": "SecurePass123!"
                  },
                  "teacherId": {
                    "type": "string",
                    "example": "T001",
                    "description": "Optional. If not provided, will be auto-generated starting from 1 per school/tenant"
                  },
                  "phone": {
                    "type": "string"
                  },
                  "gender": {
                    "type": "string",
                    "enum": [
                      "Male",
                      "Female",
                      "Other"
                    ]
                  },
                  "dateOfBirth": {
                    "type": "string",
                    "format": "date"
                  },
                  "contractType": {
                    "type": "string",
                    "enum": [
                      "Permanent",
                      "Temporary",
                      "Contract",
                      "Probation"
                    ]
                  },
                  "qualification": {
                    "type": "string"
                  },
                  "workExperience": {
                    "type": "string"
                  },
                  "dateOfJoining": {
                    "type": "string",
                    "format": "date"
                  },
                  "classIds": {
                    "type": "string",
                    "description": "JSON array of class IDs",
                    "example": "[\"uuid1\", \"uuid2\"]"
                  },
                  "subjectIds": {
                    "type": "string",
                    "description": "JSON array of subject IDs",
                    "example": "[\"uuid1\", \"uuid2\"]"
                  },
                  "basicSalary": {
                    "type": "number",
                    "format": "decimal"
                  },
                  "profileImage": {
                    "type": "string",
                    "format": "binary",
                    "description": "JPG/PNG/SVG, max 4MB"
                  },
                  "resume": {
                    "type": "string",
                    "format": "binary",
                    "description": "PDF, max 4MB"
                  },
                  "joiningLetter": {
                    "type": "string",
                    "format": "binary",
                    "description": "PDF, max 4MB"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Teacher created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "teacher": {
                      "$ref": "#/components/schemas/Teacher"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error"
          },
          "409": {
            "description": "Duplicate email"
          }
        }
      },
      "get": {
        "tags": [
          "Teachers"
        ],
        "summary": "List teachers",
        "description": "List all teachers visible to the user with RLS enforcement",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "inactive",
                "on-leave",
                "suspended",
                "resigned"
              ]
            }
          },
          {
            "in": "query",
            "name": "contractType",
            "schema": {
              "type": "string",
              "enum": [
                "Permanent",
                "Temporary",
                "Contract",
                "Probation"
              ]
            }
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            },
            "description": "Search by firstName, lastName, email, or teacherId"
          }
        ],
        "responses": {
          "200": {
            "description": "Teachers listed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "count": {
                          "type": "integer"
                        },
                        "rows": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Teacher"
                          }
                        },
                        "page": {
                          "type": "integer"
                        },
                        "limit": {
                          "type": "integer"
                        },
                        "totalPages": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/teachers/{id}": {
      "get": {
        "tags": [
          "Teachers"
        ],
        "summary": "Get teacher by ID",
        "description": "Fetch a single teacher by ID with RLS enforcement",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Teacher fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "teacher": {
                      "$ref": "#/components/schemas/Teacher"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Teacher not found"
          }
        }
      },
      "put": {
        "tags": [
          "Teachers"
        ],
        "summary": "Update teacher",
        "description": "Update teacher record with partial updates and file replacements",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "firstName": {
                    "type": "string"
                  },
                  "lastName": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "phone": {
                    "type": "string"
                  },
                  "gender": {
                    "type": "string"
                  },
                  "dateOfBirth": {
                    "type": "string",
                    "format": "date"
                  },
                  "contractType": {
                    "type": "string"
                  },
                  "status": {
                    "type": "string"
                  },
                  "profileImage": {
                    "type": "string",
                    "format": "binary"
                  },
                  "resume": {
                    "type": "string",
                    "format": "binary"
                  },
                  "joiningLetter": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Teacher updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "teacher": {
                      "$ref": "#/components/schemas/Teacher"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Teacher not found"
          },
          "409": {
            "description": "Duplicate email"
          }
        }
      },
      "delete": {
        "tags": [
          "Teachers"
        ],
        "summary": "Delete teacher",
        "description": "Soft delete a teacher (and linked user account)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Teacher deleted successfully"
          },
          "403": {
            "description": "Insufficient permissions"
          },
          "404": {
            "description": "Teacher not found"
          }
        }
      }
    },
    "/api/tenants": {
      "get": {
        "tags": [
          "Tenants"
        ],
        "summary": "List tenants",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "post": {
        "tags": [
          "Tenants"
        ],
        "summary": "Create a tenant",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Tenant"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Tenant"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/tenants/{id}": {
      "get": {
        "tags": [
          "Tenants"
        ],
        "summary": "Get tenant by id",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "put": {
        "tags": [
          "Tenants"
        ],
        "summary": "Update tenant",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "slug": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "delete": {
        "tags": [
          "Tenants"
        ],
        "summary": "Delete tenant",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Deleted"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Not Found"
          }
        }
      }
    },
    "/api/users": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "List all users",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            },
            "description": "Page number"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            },
            "description": "Items per page"
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            },
            "description": "Search by email"
          },
          {
            "in": "query",
            "name": "roleId",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Filter by role ID"
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/User"
                      }
                    },
                    "pagination": {
                      "type": "object",
                      "properties": {
                        "total": {
                          "type": "integer"
                        },
                        "page": {
                          "type": "integer"
                        },
                        "limit": {
                          "type": "integer"
                        },
                        "totalPages": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/users/profile": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "Get current logged-in user profile",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/users/{id}": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "Get user details",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/users/{id}/roles": {
      "put": {
        "tags": [
          "Users"
        ],
        "summary": "Update user roles",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "roleIds": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "uuid"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          }
        }
      }
    }
  }
}